<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gda="http://www.diamond.ac.uk/schema/gda/gda"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:corba="http://www.diamond.ac.uk/schema/gda/corba"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/util
	http://www.springframework.org/schema/util/spring-util-2.0.xsd
	http://www.diamond.ac.uk/schema/gda/gda http://www.diamond.ac.uk/schema/gda/gda/gda-gda-1.1.xsd
	http://www.diamond.ac.uk/schema/gda/corba http://www.diamond.ac.uk/schema/gda/corba/gda-corba-1.1.xsd">
	<gda:rbac />
	

	<corba:adapterfactory namespace="${gda.factory.factoryName}" />

	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location"
			value="file:${gda.config}/properties/java.properties" />
	</bean>

	<bean class="gda.spring.FindableNameSetterPostProcessor" />

	<bean id="GDAMetadata" class="gda.data.metadata.GdaMetadata">
		<property name="metadataEntries">
			<list>
				<bean id="instrument" class="gda.data.metadata.PropertyMetadataEntry">
					<property name="propertyName" value="gda.instrument" />
				</bean>
				<ref bean="title" />
				<ref bean="subdirectory" />
				<ref bean="samplename" />
			</list>
		</property>
	</bean>

	<bean id="subdirectory" class="gda.data.metadata.SubdirectoryMetadataEntry" />

	<bean id="title" class="gda.data.metadata.StoredScanMetadataEntry">
		<property name="value" value="" />
	</bean>

	<bean class="gda.data.metadata.MetadataBlaster" id="observableSubdirectory">
		<property name="storedMetadataEntry" ref="subdirectory" />
	</bean>

	<bean class="gda.data.metadata.MetadataBlaster" id="observableScanTitle">
		<property name="storedMetadataEntry" ref="title" />
	</bean>

	<bean class="gda.data.metadata.StoredMetadataEntry" id="samplename">
		<property name="name" value="samplename" />
		<property name="value" value="none" />
	</bean>
	<bean class="gda.data.metadata.MetadataBlaster" id="observableSamplename">
		<property name="storedMetadataEntry" ref="samplename" />
	</bean>
	
	<bean
		class="gda.device.scannable.DummyUnitsScannable" id="sample_thickness">
		<property name="name" value="sample_thickness" />
		<property name="inputNames"><list><value>sample_thickness</value></list></property>
		<property name="outputFormat"><list><value>%5.5g</value></list></property>
		<property name="protectionLevel" value="1" />
		<property name="userUnits" value="mm" />
	</bean>
	
	<bean
		class="gda.device.scannable.DummyUnitsScannable" id="sample_concentration">
		<property name="name" value="sample_concentration" />
		<property name="inputNames"><list><value>"sample_concentration"</value></list></property>
		<property name="outputFormat"><list><value>%5.5g</value></list></property>
		<property name="protectionLevel" value="1" />
		<property name="userUnits" value="mg/mL" />
	</bean>
	
	<bean class="uk.ac.gda.server.ncd.beans.StoredDetectorInfoImpl" id="detectorInfoPath">
		<property name="currentDataDirectoryUpdater" ref="observableSubdirectory"/>
	</bean>
	
	<bean class="org.springframework.remoting.rmi.RmiServiceExporter">
		<property name="serviceName" value="gda/detectorInfoPath"/>
		<property name="service" ref="detectorInfoPath"/>
		<property name="serviceInterface" value="uk.ac.gda.server.ncd.beans.StoredDetectorInfo"/>
	</bean>

	<bean id="GDAHashtable" class="gda.util.findableHashtable.FindableHashtable" />

	<bean id="commandQueue" class="gda.commandqueue.CommandQueue" />

	<bean id="commandQueueProcessor" class="gda.commandqueue.FindableProcessorQueue">
		<property name="queue" ref="commandQueue" />
		<property name="startImmediately" value="true" />
		<property name="logFilePath" value="${gda.var}/commandQueueProcessor.log" />
	</bean>

	<bean class="uk.ac.gda.remoting.server.GdaRmiServiceExporter">
		<property name="serviceName" value="gda/commandQueueProcessor" />
		<property name="service" ref="commandQueueProcessor" />
		<property name="serviceInterface" value="gda.commandqueue.IFindableQueueProcessor" />
	</bean>
	<!--*************************************** -->
	<!-- *** NCD devices section *** -->
	<!--*************************************** -->
	<!-- -->
	<bean id="bsdiode" class="gda.device.monitor.DummyMonitor" />
	<bean id="DAServerS" class="gda.device.detector.DummyDAServer">
		<property name="local" value="true" />
	</bean>
	<bean id="DAServerW" class="gda.device.detector.DummyDAServer">
		<property name="local" value="true" />
	</bean>
	<bean id="DAServerT" class="gda.device.detector.DummyDAServer">
		<property name="local" value="true" />
	</bean>
	<bean id="SaxsMemory" class="gda.device.memory.Gdscaler">
		<property name="daServerName" value="DAServerS" />
		<property name="width" value="512" />
		<property name="height" value="512" />
		<property name="supportedDimensions">
			<list>
				<value>128</value>
				<value>256</value>
				<value>512</value>
				<value>1024</value>
				<value>2048</value>
				<value>4096</value>
				<value>8192</value>
			</list>
		</property>
		<property name="openCommand" value="gdscaler open 'saxs' 1" />
		<property name="sizeCommand" value="gdscaler get-mem-size 'saxs'" />
	</bean>
	<bean id="WaxsMemory" class="gda.device.memory.Gdscaler">
		<property name="daServerName" value="DAServerW" />
		<property name="width" value="512" />
		<property name="height" value="1" />
		<property name="openCommand" value="gdscaler open 'waxs' 1" />
		<property name="sizeCommand" value="gdscaler get-mem-size 'waxs'" />
	</bean>
	<bean id="CalibMemory" class="gda.device.memory.Scaler">
		<property name="name" value="CalibMemory" />
		<property name="daServerName" value="DAServerT" />
		<property name="width" value="9" />
		<property name="height" value="1" />
		<property name="openCommand" value="tfg open-cc" />
	</bean>
	<bean id="TimesMemory" class="gda.device.memory.GdhistTimes">
		<property name="daServerName" value="DAServerT" />
		<property name="width" value="8" />
		<property name="height" value="1" />
		<property name="openCommand" value="module open 'tfg_times' header" />
	</bean>
	<bean id="Tfg" class="gda.device.timer.Etfg">
		<!-- <property name="daServerName" value="realDAServer" /> -->
		<property name="daServerName" value="DAServerT" />
		<property name="showArmed" value="true" />
	</bean>

	<bean id="Saxs" class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector">
		<property name="detectorType" value="SAXS" />
		<property name="memory" ref="SaxsMemory" />
		<property name="pixelSize" value="0.000383" />
	</bean>
	<bean id="Saxs2" class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector">
		<property name="detectorType" value="SAXS" />
		<property name="memory" ref="WaxsMemory" />
	</bean>

	<bean id="Waxs" class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector">
		<property name="detectorType" value="WAXS" />
		<property name="memory" ref="WaxsMemory" />
	</bean>
	<bean id="Waxs2" class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector">
		<property name="detectorType" value="WAXS" />
		<property name="memory" ref="SaxsMemory" />
	</bean>

	<bean id="Scaler" class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector">
		<property name="detectorType" value="CALIB" />
		<property name="memory" ref="CalibMemory" />
	</bean>

	<bean id="sao1"
		class="uk.ac.gda.server.ncd.subdetector.ConstantScalingAndOffset">
		<property name="offset" value="10" />
		<property name="scaling" value="0.5" />
		<property name="description" value="test" />
	</bean>
	
	<bean id="sao2"
		class="uk.ac.gda.server.ncd.subdetector.ConstantScalingAndOffset">
		<property name="offset" value="8" />
		<property name="scaling" value="0.7" />
		<property name="description" value="test" />
	</bean>

	<bean id="I0"
		class="uk.ac.gda.server.ncd.subdetector.SingleScalerWithScalingAndOffset">
		<property name="detectorType" value="CALIB" />
		<property name="memory" ref="CalibMemory" />
		<property name="units" value="counts" />
		<property name="channel" value="1" />
		<property name="label" value="data" />
		<property name="scalingAndOffset" ref="sao1" />
	</bean>
	
	<bean id="It"
		class="uk.ac.gda.server.ncd.subdetector.SingleScalerWithScalingAndOffset">
		<property name="detectorType" value="CALIB" />
		<property name="memory" ref="CalibMemory" />
		<property name="units" value="counts" />
		<property name="channel" value="1" />
		<property name="label" value="data" />
		<property name="scalingAndOffset" ref="sao2" />
	</bean>

	<bean id="TfgTimes" class="uk.ac.gda.server.ncd.subdetector.NcdTimesDetector">
		<property name="detectorType" value="TIMES" />
		<property name="memory" ref="TimesMemory" />
	</bean>

	<bean id="ncddetectors" class="uk.ac.gda.server.ncd.detectorsystem.NcdDetectorSystem">
		<property name="timer" ref="Tfg" />
		<property name="detectors">
			<list>
				<ref bean="Saxs" />
				<ref bean="Waxs" />
				<ref bean="Scaler" />
				<ref bean="I0" />
				<ref bean="It" />
				<ref bean="TfgTimes" />
			</list>
		</property>
	</bean>

	<bean id="bragg_motor" class="gda.device.motor.DummyMotor">
	</bean>
	<bean id="bragg" class="gda.device.scannable.ScannableMotor">
		<property name="motor" ref="bragg_motor" />
		<property name="scalingFactor" value="-1" />
	</bean>
	<bean id="DCM" class="gda.device.scannable.scannablegroup.ScannableGroup">
		<property name="groupMembers">
			<list>
				<ref bean="bragg" />
			</list>
		</property>
	</bean>
	<bean id="dcm_energy" class="gda.device.scannable.ScannableMotor">
		<property name="motor" ref="bragg_motor" />
		<property name="scalingFactor" value="-1" />
	</bean>

	<bean id="shutter" class="gda.device.enumpositioner.DummyValve" />

	<bean id="energy" class="uk.ac.gda.server.ncd.scannable.EnergyScannable">
		<property name="bragg" ref="bragg" />
	</bean>
	<bean id="ncdlistener" class="uk.ac.gda.server.ncd.plotting.ListenerDispatcher">
		<property name="ncdDetector" ref="ncddetectors"></property>
		<property name="energyScannable" ref="energy" />
	</bean>

	<bean id="bssc" class="uk.ac.gda.devices.bssc.BioSAXSSampleChanger">
		<property name="hostname" value="diamrd2801" />
		<property name="port" value="9555" />
	</bean>
	<bean id="bsscscannable" class="uk.ac.gda.devices.bssc.scannable.BSSCScannable">
		<property name="bssc" ref="bssc" />
		<property name="local" value="false" />
	</bean>

	<bean id="ispybNotifier" class="uk.ac.gda.devices.bssc.ispyb.NotifyISpyBObserversObject">
		<constructor-arg value="localhost" />
		<constructor-arg value="9877" />
	</bean>

	<bean id="udplistener" class="uk.ac.gda.devices.bssc.ispyb.UDPListener">
		<property name="port" value="9877" />
		<property name="running" value="true" />
		<property name="prefix" value="biosaxs" />
	</bean>
	
	<bean class="uk.ac.gda.devices.bssc.ispyb.BioSAXSDBFactory">
		<property name="jdbcURL"
			value="jdbc:oracle:thin:@ws096.diamond.ac.uk:1521:xe" />
		<property name="notifyObject" ref="ispybNotifier" />
		<!-- // protected String testURL = "jdbc:oracle:thin:@sci-serv2.diamond.ac.uk:1521:xe"; -->
		<!-- // protected String liveURL = "jdbc:oracle:thin:@duoserv12.diamond.ac.uk:1521:ispyb"; -->
	</bean>

	<bean id="jythonServerFacade" class="gda.jython.JythonServerFacade">
		<constructor-arg ref="command_server" />
	</bean>

	<bean id="SimpleServlet" class="gda.util.simpleServlet.FindableSimpleServlet" />
	<bean id="ScanDataStore" class="gda.util.simpleServlet.FindableSimpleServlet" />
	<bean id="plot_server"
		class="uk.ac.diamond.scisoft.analysis.plotserver.PlotServerBase" />

	<bean id="bcm"
		class="gda.server.beamlineConfigurationManager.BeamlineConfigurationManager" />
	<bean id="FileRegistrar" class="gda.data.fileregistrar.FileRegistrar">
		<property name="name" value="FileRegistrar" />
		<property name="directory" value="/tmp/ncdsim-" />
	</bean>
	<bean id="twodscan" class="gda.data.scan.TwoDPlotListener">
		<property name="plotPanel" value="Plot 2D" />
	</bean>
	<bean id="scan2elog" class="gda.data.ScanToElogExtender">
		<property name="logID" value="DAG" />
		<property name="groupID" value="SCAN" />
		<property name="extractorList">
			<list>
				<bean class="uk.ac.gda.server.ncd.data.TfgSettingsExtractor" />
			</list>
		</property>
	</bean>
	<bean id="DataWriterFactory" class="gda.data.scan.datawriter.DefaultDataWriterFactory">
		<property name="name" value="DataWriterFactory" />
		<property name="dataWriterExtenders">
			<list>
				<ref bean="FileRegistrar" />
				<ref bean="twodscan"/>
				<!-- <ref bean="scan2elog" /> -->
			</list>
		</property>
	</bean>
	<bean id="command_server" class="gda.jython.JythonServer">
		<property name="jythonScriptPaths">
			<bean class="gda.jython.ScriptPaths">
				<property name="projects">
					<list>
						<bean class="gda.jython.ScriptProject">
							<property name="path" value="${gda.config}/users/scripts/" />
							<property name="name" value="Scripts: User" />
							<property name="type" value="USER" />
						</bean>
						<bean class="gda.jython.ScriptProject">
							<property name="path" value="${gda.config}/scripts/" />
							<property name="name" value="Scripts: Config" />
							<property name="type" value="CONFIG" />
						</bean>
						<bean class="gda.jython.ScriptProject">
							<property name="path"
								value="${gda.install.git.loc}/gda-core.git/uk.ac.gda.core/scripts/" />
							<property name="name" value="Scripts: Core" />
							<property name="type" value="CORE" />
						</bean>
						<bean class="gda.jython.ScriptProject">
							<property name="path"
								value="${gda.install.git.loc}/gda-scm.git/plugins/uk.ac.gda.server.ncd/scripts/" />
							<property name="name" value="Scripts: Ncd" />
							<property name="type" value="CORE" />
						</bean>
						<bean class="gda.jython.ScriptProject">
							<property name="path"
								value="${gda.install.git.loc}/gda-scm.git/plugins/uk.ac.gda.devices.bssc/scripts/" />
							<property name="name" value="Scripts: BSSC" />
							<property name="type" value="CORE" />
						</bean>
						<bean class="gda.jython.ScriptProject">
							<property name="path"
								value="${gda.install.git.loc}/gda-scm.git/plugins/uk.ac.gda.devices.hplc/scripts/" />
							<property name="name" value="Scripts: HPLC" />
							<property name="type" value="CORE" />
						</bean>
					</list>
				</property>
				<property name="startupScript" value="${gda.config}/scripts/localStation.py" />
			</bean>
		</property>
		<property name="gdaVarDirectory" value="${gda.config}/var" />
		<property name="cacheDirectory" value="${gda.config}/var/jythonCache" />
		<property name="remotePort" value="9999" />
	</bean>

	<bean class="gda.device.scannable.DummyMultiElementScannable" id="dummystage">
		<property name="inputNames">
			<list>
				<value>x</value>
				<value>y</value>
			</list>
		</property>
		<property name="outputFormat">
			<list>
				<value>%5.5g</value>
				<value>%5.5g</value>
			</list>
		</property>
		<property name="protectionLevel" value="3"></property>
	</bean>
	<bean class="gda.device.scannable.DummyUnitsScannable" id="sample_temp">
		<property name="inputNames">
			<list>
				<value>sample_temp</value>
			</list>
		</property>
		<property name="outputFormat">
			<list>
				<value>%5.5g</value>
			</list>
		</property>
		<property name="protectionLevel" value="3"></property>
	</bean>

	<bean class="gda.device.scannable.DummyUnitsScannable" id="analyser_slit">
		<property name="inputNames">
			<list>
				<value>analyser_slit</value>
			</list>
		</property>
		<property name="outputFormat">
			<list>
				<value>%5.0f</value>
			</list>
		</property>
		<property name="protectionLevel" value="3"></property>
		<property name="lowerGdaLimits" value="0" />
		<property name="upperGdaLimits" value="1000" />
	</bean>

	<bean class="gda.device.scannable.DummyUnitsScannable" id="exit_slit">
		<property name="inputNames">
			<list>
				<value>exit_slit</value>
			</list>
		</property>
		<property name="outputFormat">
			<list>
				<value>%5.5g</value>
			</list>
		</property>
		<property name="protectionLevel" value="3"></property>
		<property name="lowerGdaLimits" value="0" />
		<property name="upperGdaLimits" value="5" />
	</bean>

	<bean id="motor_motor" class="gda.device.motor.DummyMotor">
		<property name="local" value="true" />
	</bean>
	<bean id="motor" class="gda.device.scannable.ScannableMotor">
		<property name="motor" ref="motor_motor" />
		<property name="local" value="false" />
	</bean>
	<corba:export namespace="ncdsim" />

	<bean id="biosaxsprocessingrunner" class="uk.ac.gda.server.ncd.data.ProcessingRunner">
		<property name="environment">
			<map>
				<entry key="GDA_CONFIG" value="${gda.config}" />
				<entry key="DAWN" value="/dls/b21/data/2014/cm4976-1/tmp/DawnDiamond-1.5.0.v20140314-1320-linux64/dawn" />
				<entry key="MOML" value="${gda.config}/processing/ncd_model.moml" />
				<entry key="ISPYBUPDATE" value="${gda.config}/processing/updateispyb.py" />
				<entry key="EDNAPYSCRIPT" value="${gda.install.git.loc}/gda-scm.git/plugins/uk.ac.gda.devices.bssc/scripts/runAnalysisAndPutIntoDatabase.py" />
			</map>
		</property>
		<property name="executablePath" value="${gda.config}/processing/biosaxs.sh" />
		<property name="detectorInfo" ref="detectorInfoPath" />
	</bean>
	
	<bean
		class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="staticMethod"
			value="gda.data.scan.datawriter.NexusDataWriter.setLocationmap" />
		<property name="arguments">
			<map>
				<entry key="energy">
					<bean
						class="uk.ac.gda.server.ncd.scannable.EnergyScannableWriter">
						<property name="paths">
							<list>
								<value>instrument:NXinstrument/monochromator:NXmonochromator/energy</value>
								<value>instrument:NXinstrument/insertion_device:NXinsertion_device/gap</value>
							</list>
						</property>
						<property name="units">
							<list>
								<value>keV</value>
								<value>mm</value>
							</list>
						</property>
						<property name="prerequisiteScannableNames">
							<list>
							</list>
						</property>
						<property name="uncertaintyFraction" value="1.14e-4" />
					</bean>
				</entry>
				<entry key="sample_name">
					<bean
						class="gda.data.scan.datawriter.scannablewriter.SingleScannableWriter">
						<property name="paths" value="sample:NXsample/name" />
						<property name="prerequisiteScannableNames">
							<list>
								<!-- <value>cff</value> -->
							</list>
						</property>
					</bean>
				</entry>
				<entry key="sample_thickness">
					<bean
						class="gda.data.scan.datawriter.scannablewriter.SingleScannableWriter">
						<property name="paths" value="sample:NXsample/thickness" />
						<property name="prerequisiteScannableNames">
							<list>
								<!-- <value>cff</value> -->
							</list>
						</property>
					</bean>
				</entry>
				<entry key="sample_concentration">
					<bean
						class="gda.data.scan.datawriter.scannablewriter.SingleScannableWriter">
						<property name="paths" value="sample:NXsample/concentration	" />
						<property name="prerequisiteScannableNames">
							<list>
								<!-- <value>cff</value> -->
							</list>
						</property>
					</bean>
				</entry>
			</map>
		</property>
	</bean>
	<bean
		class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="staticMethod"
			value="gda.data.scan.datawriter.NexusDataWriter.setMetadatascannables" />
		<property name="arguments">
			<set>
				<value>energy</value>
				<value>sample_name</value>
				<value>sample_thickness</value>
			</set>
		</property>
	</bean>
</beans>